# JASPAR 2020

Depending on the ChIP-seq data repository (e.g., ChIP-atlas or ENCODE) the pipeline may slightly vary. For this reason there is a folder for each repository with its respective Snakefile and Config file.

This folder is divided in 2 subfolders:

- bin       : with all the executable files called in the workflow.
- CHIP-atlas: contains all the analysis performed in ChIP-atlas datasets + Snakefile + Config file


## Dependencies.

The following software and R libraries must be installed in order to run the complete pipeline.

- *R*
	- data.table
  	- dplyr
  	- future.apply
  	- reshape2

- *RSAT* (Regulatory Sequences analysis Tools) software: http://rsat-tagc.univ-mrs.fr/rsat/
- *snakemake*: https://snakemake.readthedocs.io/en/stable/index.html


## Download ChIP-seq datasets from ChIP-atlas


1. Change the directory:
```
cd motif_discovery_pipeline/ChIP-atlas
```


2. Launch the script. You must specify the directory ( current directory '.' in this example) and the genome version (ce10, C elegans). This program will first download the experiment table from ChIP-atlas and then all the experiments (narrowpeak format) for the given genome.
```
Rscript bin/ChIP_atlas_download_TF_peaks_by_genome.R . ce10
```


## Download genomic files: chromosome sizes and fasta files. C elegans example.


1. Go to UCSC download page: http://hgdownload.cse.ucsc.edu/downloads.html#c_elegans

2. Look for the ce10 (or any genome) table 'Oct. 2010 (WS220/ce10)', click on 'Full data set'

3. Download the genome size file:
   ```
   wget http://hgdownload.cse.ucsc.edu/goldenPath/ce10/bigZips/ce10.chrom.sizes
   ```

4. Download the ce10 genome in 2bit format:
   ```
   wget http://hgdownload.cse.ucsc.edu/goldenPath/ce10/bigZips/ce10.2bit
   ```

5. Download the script 2bittofa, this script convert the 2bit file into fasta sequences:
   ```
   wget http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/twoBitToFa
   ```

6. Convert the 2bit file to fasta sequences:
   ```
   twoBitToFa ce10.2bit ce10.fa
   ```

7. twoBitToFa information: http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/

8. Update the snakemake config file with the directory of the genome.


## Launching the pipeline

The pipeline must be ran in two steps:

- Step 1: motif discovery. The program *RSAT peak-motifs* is called, this program runs four motif discovery algorithms (over-represented k-mers, over-represented spaced-k-mers, positionally biased k-mers, k-mers enriched in central windows) to discover significant motifs, see 10.1093/nar/gkr1104. This can be launched by running the *Snakefile*, you can parallelize the process using the argument *--cores*.

The *Snakefile* contain a series of rules, for the motif discovery steps, it searched for the datasets in *narrowPeak* format. 

Once completed, this step will generate one folder per dataset with the *RSAT peak-motifs* results. 

```
snakemake [--cores X]
```

- Step 2: selecting centrally enriched motifs. Note that given the ChIP-seq dataset quality and the number of peaks, many datasets may not produce any significant motif. This step must be ran after completed the motif discovery step.

**The *Snakefile* will search for the motifs in fasta format obtained from *RSAT peak-motifs* .** So be sure to run this step after completing the step 1. 


```
snakemake [--cores X]
```